<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nika Travel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/frontend.css') }}">
    {% if request.path.startswith('/admin') %}
        <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    {% endif %}

    <!-- üé® –í–°–¢–†–û–ï–ù–ù–´–ô –°–¢–ò–õ–¨ –°–ê–ô–¢–ê -->
    <style>
	  :root {
        --bottom-nav-height: 70px;
      }

      body {
        margin: 0;
        font-family: 'Poppins', sans-serif;
        background-color: #f9f3eb;
        color: #2b2b2b;
      }

      /* üîù –•–µ–¥–µ—Ä */
      .header {
        position: sticky;
        top: 0;
        z-index: 100001;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 18px 40px;
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      .header-logo {
        font-size: 28px;
        font-weight: 700;
        text-decoration: none;
        color: #d6ae7b;
        transition: 0.3s;
      }
      .header-logo:hover {
        color: #c19668;
      }

      /* –ú–µ–Ω—é */
      .nav-links {
        display: flex;
        gap: 25px;
      }
      .nav-links a {
        text-decoration: none;
        color: #333;
        font-weight: 500;
        position: relative;
        transition: color 0.3s;
      }
      .nav-links a::after {
        content: "";
        position: absolute;
        bottom: -4px;
        left: 0;
        width: 0%;
        height: 2px;
        background: linear-gradient(135deg, #eacda3, #d6ae7b);
        transition: 0.3s;
      }
      .nav-links a:hover {
        color: #d6ae7b;
      }
      .nav-links a:hover::after {
        width: 100%;
      }

      /* –ë—É—Ä–≥–µ—Ä */
      .burger {
        display: none;
        flex-direction: column;
        gap: 5px;
        cursor: pointer;
      }
      .burger div {
        width: 25px;
        height: 3px;
        background: #333;
        border-radius: 3px;
      }

      .footer {
        text-align: center;
        padding: 40px 20px;
        font-size: 15px;
        background: rgba(255, 255, 255, 0.4);
        backdrop-filter: blur(10px);
        color: #444;
        margin-top: 80px;
        border-top: 1px solid rgba(255, 255, 255, 0.3);
      }
	  
	  /* üì± —Å–∫—Ä—ã–≤–∞–µ–º —Ñ—É—Ç–µ—Ä –Ω–∞ –º–æ–±–∏–ª–∫–µ */
      @media (max-width: 768px) {
        .footer {
          display: none;
        }
      }
	  
      /* ‚ùå —Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ü–ö) */
      .mobile-bottom-nav {
        display: none;
      }

      /* üå¥ –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
      [data-aos] {
        opacity: 0;
        transform: translateY(30px);
        transition: all 0.7s ease;
      }
      [data-aos].aos-animate {
        opacity: 1;
        transform: translateY(0);
      }
	 
      .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 70px;
        background: rgba(255, 255, 255, 0.95);

        display: none;                 /* üî• –í–ê–ñ–ù–û */
        justify-content: space-around;
        align-items: center;
  
        border-top: 1px solid rgba(0,0,0,0.08);
        z-index: 100001;
      }

     .nav-item {
       display: flex;
       flex-direction: column;
       align-items: center;
       font-size: 11px;
       color: #999;
       text-decoration: none;
     }

     .nav-item img {
       width: 26px;
       height: 26px;
       margin-bottom: 4px;
     }

     .nav-item.active span {
       color: #c89b63; /* –ø–µ—Å–æ—á–Ω—ã–π —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π */
     }
	 
     @media (max-width: 768px) {
       .bottom-nav {
         display: flex;          /* üëà –≤–∫–ª—é—á–∞–µ–º –¢–û–õ–¨–ö–û –ù–ê –ú–û–ë–ò–õ–ö–ï */
         flex-direction: row;    /* üëà –Ø–í–ù–û –≥–æ–≤–æ—Ä–∏–º: –í –†–Ø–î */
       }

       body {
         padding-bottom: 80px;
       }

       .header {
         display: none !important;
       }
     }
	 
	 .fav-btn {
       background: none;
       border: none;
       padding: 0;
       cursor: pointer;
     }

     .fav-heart {
       width: 28px;
       height: 28px;
       transition: transform 0.2s ease;
     }

     .fav-btn:active .fav-heart {
       transform: scale(0.9);
     }

     .page {
       animation: slideUp 0.35s ease forwards;
     }

     .page-exit {
       animation: slideDown 0.35s ease forwards;
     }

     @keyframes slideUp {
       from {
         transform: translateY(40px);
         opacity: 0;
       }
       to {
         transform: translateY(0);
         opacity: 1;
       }
     }

     @keyframes slideDown {
       from {
         transform: translateY(0);
         opacity: 1;
       }
       to {
         transform: translateY(-40px);
         opacity: 0;
       }
     }
	 
	 .tour-fixed-buttons {
       position: fixed;
       left: 0;
       right: 0;
       bottom: 0;
       background: rgba(255,255,255,0.3);
       padding: 12px 20px;
       box-shadow: 0 -2px 15px rgba(0,0,0,0.1);
       z-index: 1000;
     }

     @media (max-width: 768px) {
       .tour-fixed-buttons {
         bottom: var(--bottom-nav-height);
       }
     }
	 
	 .page-loader {
       position: fixed;
       inset: 0;
       background: rgba(249, 243, 235, 0.4);
       -webkit-backdrop-filter: blur(8px);
       z-index: 99999;
       opacity: 0;
       pointer-events: none;
       transition: opacity 0.25s ease;
     }

     .page-loader.active {
       opacity: 1;
       pointer-events: all;
     }
	 
	 /* ‚ùå —É–±–∏—Ä–∞–µ–º —Å–∏–Ω–∏–π —Ñ–æ–∫—É—Å –∏ —Ç–∞–ø-–ø–æ–¥—Å–≤–µ—Ç–∫—É */
     button,
     a,
     input,
     textarea,
     select {
       outline: none;
       -webkit-tap-highlight-color: transparent;
     }

     /* ‚ùå —É–±–∏—Ä–∞–µ–º —Ñ–æ–∫—É—Å-—Ä–∞–º–∫—É */
     button:focus,
     a:focus,
     input:focus,
     textarea:focus,
     select:focus {
       outline: none;
       box-shadow: none;
     }

     /* ‚ùå —É–±–∏—Ä–∞–µ–º active-–ø–æ–¥—Å–≤–µ—Ç–∫—É */
     button:active,
     a:active {
       outline: none;
       box-shadow: none;
     }
	 
	 * {
       -webkit-tap-highlight-color: transparent;
     }

     button,
     .fav-btn,
     .nav-item {
       transition: transform 0.08s ease, filter 0.08s ease;
	   touch-action: manipulation;
     }

     button:active,
     .fav-btn:active,
     .nav-item:active {
       transform: scale(0.96);
       filter: brightness(0.9);
	   box-shadow: inset 0 2px 6px rgba(0,0,0,0.15);
     }
	 
	 .sheet-overlay {
       position: fixed;
       inset: 0;
       background: rgba(0,0,0,0.25);
       opacity: 0;
       pointer-events: none;
       transition: opacity .3s ease;
       z-index: 100002;
     }

     .sheet-overlay.active {
       opacity: 1;
       pointer-events: all;
     }

     .sheet {
       position: absolute;
       bottom: -100%;
       left: 0;
       width: 100%;
       max-height: 90vh;
       background: rgba(255,255,255,0.9);
       backdrop-filter: blur(14px);
       border-radius: 22px 22px 0 0;
       transition: bottom .35s ease;
       overflow-y: auto;
     }

     .sheet-overlay.active .sheet {
       bottom: 0;
     }

     .sheet-handle {
       width: 44px;
       height: 5px;
       background: rgba(0,0,0,0.25);
       border-radius: 4px;
       margin: 10px auto;
     }

     .sheet-content {
       padding: 20px;
     }

    </style>

    <!-- Aviasales -->
    {% if not request.path.startswith('/admin') %}
    <script data-noptimize="1" data-cfasync="false" data-wpfc-render="false">
      (function () {
          var script = document.createElement("script");
          script.async = 1;
          script.src = 'https://emrld.cc/NDQ4ODQ4.js?t=448848';
          document.head.appendChild(script);
      })();
    </script>
    {% endif %}
</head>

<body>
<link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
{% if not request.path.startswith('/admin') %}
<div class="header">
  <a href="{{ url_for('index') }}" class="header-logo">Nika Travel</a>

  <div class="burger" onclick="toggleMenu()">
    <div></div><div></div><div></div>
  </div>

  <div class="nav-links" id="navMenu">
    <a href="{{ url_for('index') }}">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="{{ url_for('about') }}">–û –Ω–∞—Å</a>
	<a href="{{ url_for('faq') }}">FAQ</a>
    <a href="{{ url_for('filter_page') }}">–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç—É—Ä—ã</a>
    <a href="{{ url_for('flights') }}">–ê–≤–∏–∞–±–∏–ª–µ—Ç—ã</a>
    <a href="{{ url_for('contacts') }}">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
  </div>
</div>
{% endif %}

<div class="page" id="page">
  {% block content %}{% endblock %}
</div>

{% if request.endpoint == 'tour_detail' %}
<form
  action="{{ url_for('confirmation_page', tour_id=tour_id) }}"
  method="get"
  class="tour-fixed-buttons-wrapper"
>
  <input type="hidden" name="tourists" id="formTourists" value="1">
  <input type="hidden" name="nights" id="formNights" value="{{ tour.nights }}">
  <input type="hidden" name="total_price" id="formPrice" value="{{ tour.price }}">

  <div class="tour-fixed-buttons">
    <button type="submit" class="btn-book">
      –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ç—É—Ä –∑–∞ {{ tour.price }} ‚Ç∏
    </button>
  </div>
</form>
{% endif %}

<footer class="footer">
  Nika Travel ¬© 2025
</footer>

<!-- ===== MOBILE BOTTOM NAV ===== -->
<nav class="bottom-nav">

  <a href="/" class="nav-item {% if active_page == 'home' %}active{% endif %}">
    <img src="{{ url_for('static', filename='knopki/' + ('home_active.png' if active_page == 'home' else 'home_pasive.png')) }}">
    <span>–ì–ª–∞–≤–Ω–∞—è</span>
  </a>

  <a href="/favorites"
     id="favorites-icon"
     class="nav-item {% if active_page == 'favorites' %}active{% endif %}">
    <img src="{{ url_for('static', filename='knopki/' + ('love_active.png' if active_page == 'favorites' else 'love_pasive.png')) }}">
    <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
  </a>

  <a href="/my-requests" class="nav-item {% if active_page == 'requests' %}active{% endif %}">
    <img src="{{ url_for('static', filename='knopki/' + ('zayavka_active.png' if active_page == 'requests' else 'zayavka_pasive.png')) }}">
    <span>–ó–∞—è–≤–∫–∏</span>
  </a>

  <a href="/profile" class="nav-item {% if active_page == 'profile' %}active{% endif %}">
    <img src="{{ url_for('static', filename='knopki/' + ('login_active.png' if active_page == 'profile' else 'login_pasive.png')) }}">
    <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
  </a>

</nav>

<div id="page-loader" class="page-loader"></div>

<div id="sheet" class="sheet-overlay" onclick="if(event.target.id==='sheet')this.classList.remove('active')">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-content" id="sheetContent"></div>
  </div>
</div>

<script>
function toggleMenu() {
  const menu = document.getElementById('navMenu');
  menu.classList.toggle('show');
}
</script>

<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  new Swiper('.banner-swiper', {
    loop: true,
    grabCursor: true, // —Å–≤–∞–π–ø –ø–∞–ª—å—Ü–µ–º –∏–ª–∏ –º—ã—à–∫–æ–π
    pagination: {
      el: '.swiper-pagination',
      clickable: true,
    },
    autoplay: false // ‚ùå –æ—Ç–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É
  });
});
</script>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script>
  AOS.init({ duration: 900, once: true });
</script>

<script>
document.addEventListener("scroll", () => {
  document.querySelectorAll("section h2").forEach(el => {
    const rect = el.getBoundingClientRect();
    if (rect.top < window.innerHeight - 100) el.classList.add("visible");
  });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  /* –ë–∞–Ω–Ω–µ—Ä */
  new Swiper('.banner-swiper', {
    loop: true,
    grabCursor: true,
    pagination: {
      el: '.swiper-pagination',
      clickable: true,
    },
    autoplay: false
  });
  
  new Swiper('.kaspi-swiper', {
    slidesPerView: 'auto',
    spaceBetween: 14,
    freeMode: true,
    grabCursor: true
  });

  /* –ú–µ—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç –ø–æ—Å–µ—Ç–∏—Ç—å */
  new Swiper('.places-swiper', {
    loop: false,
    slidesPerView: 3,       // üëà –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 3 –∫–∞—Ä—Ç–æ—á–∫–∏
    spaceBetween: 20,       // üëà —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –Ω–∏–º–∏
    navigation: {           // —Å—Ç—Ä–µ–ª–æ—á–∫–∏ —É–∂–µ –µ—Å—Ç—å –≤ HTML
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    breakpoints: {          // –∞–¥–∞–ø—Ç–∏–≤
      0:   { slidesPerView: 1 },
      768: { slidesPerView: 2 },
      1024:{ slidesPerView: 3 }
    }
  });
});
</script>

<script>
document.addEventListener('scroll', () => {
  const home = document.querySelector('.nav-item[href="/"]');
  if (!home) return;
  if (window.scrollY < 200) home.classList.add('active');
  else home.classList.remove('active');
});
</script>

<script>
function toggleFav(id){
  let fav = JSON.parse(localStorage.getItem('fav')||'[]');
  fav = fav.includes(id) ? fav.filter(x=>x!==id) : [...fav, id];
  localStorage.setItem('fav', JSON.stringify(fav));
}
</script>

<script>
function addToFavorites(event, tourId, btn) {
  event.preventDefault();

  // 1Ô∏è‚É£ –ê–Ω–∏–º–∞—Ü–∏—è –æ—Å—Ç–∞—ë—Ç—Å—è
  flyToFavorites(event);

  // 2Ô∏è‚É£ –†–∞–±–æ—Ç–∞–µ–º —Å localStorage
  let favs = JSON.parse(localStorage.getItem('favorites') || '[]');

  const img = btn.querySelector('.fav-heart');

  if (favs.includes(tourId)) {
    // —É–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
    favs = favs.filter(id => id !== tourId);
    if (img) img.src = '/static/icons/heart-outline.png';
  } else {
    // –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
    favs.push(tourId);
    if (img) img.src = '/static/icons/heart-filled.png';
  }

  localStorage.setItem('favorites', JSON.stringify(favs));

  // 3Ô∏è‚É£ —Ç–∏—Ö–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–ë–ï–ó –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏)
  fetch('/add-to-favorites/' + tourId, { method: 'GET' });
}
</script>

<script>
function flyToFavorites(event) {
  const button = event.currentTarget;
  const target = document.getElementById('favorites-icon');
  if (!target) return;

  const btnRect = button.getBoundingClientRect();
  const targetRect = target.getBoundingClientRect();

  const clone = button.cloneNode(true);
  clone.style.position = 'fixed';
  clone.style.left = btnRect.left + 'px';
  clone.style.top = btnRect.top + 'px';
  clone.style.zIndex = 9999;
  clone.style.transition = 'all 0.8s ease';
  clone.style.pointerEvents = 'none';

  document.body.appendChild(clone);

  requestAnimationFrame(() => {
    clone.style.left = targetRect.left + 'px';
    clone.style.top = targetRect.top + 'px';
    clone.style.transform = 'scale(0.2)';
    clone.style.opacity = '0';
  });

  setTimeout(() => clone.remove(), 900);
}
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const favs = JSON.parse(localStorage.getItem('favorites') || '[]');

  document.querySelectorAll('.fav-btn').forEach(btn => {
    const id = btn.getAttribute('data-tour-id');
    const img = btn.querySelector('.fav-heart');

    if (id && favs.includes(Number(id)) && img) {
      img.src = '/static/icons/heart-filled.png';
    }
  });
});
</script>

<script>
window.addEventListener('load', () => {
  const loader = document.getElementById('page-loader');
  if (loader) loader.classList.remove('active');
});
</script>

<script>
document.addEventListener('click', async (e) => {
  const link = e.target.closest('a');
  if (!link) return;

  const href = link.getAttribute('href');
  if (!href || href.startsWith('#') || href.startsWith('http')) return;

  e.preventDefault();

  try {
    const res = await fetch(href, {
      headers: { 'X-Sheet': '1' },
      redirect: 'follow'
    });

    // üî• –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞–ª –ª–æ–≥–∏–Ω ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ–º —à—Ç–æ—Ä–∫—É
    if (res.url.includes('/login')) {
      const html = await res.text();
      openSheetWithHTML(html);
      return;
    }

    // –∏–Ω–∞—á–µ –æ–±—ã—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
    window.location.href = href;

  } catch (err) {
    window.location.href = href;
  }
});

function openSheetWithHTML(html) {
  const sheet = document.getElementById('sheet');
  const content = document.getElementById('sheetContent');
  content.innerHTML = html;
  sheet.classList.add('active');
}
</script>

<script>
document.addEventListener('submit', async (e) => {
  const form = e.target;
  if (!form.closest('#sheetContent')) return;

  e.preventDefault();

  const res = await fetch(form.action, {
    method: 'POST',
    headers: {
      'X-Sheet': '1'
    },
    body: new FormData(form)
  });

  const data = await res.json();

  if (data.success) {
    document.getElementById('sheet').classList.remove('active');
    location.reload(); // –æ–±–Ω–æ–≤–∏–º UI (–∏–∑–±—Ä–∞–Ω–Ω–æ–µ / –ø—Ä–æ—Ñ–∏–ª—å)
  }
});
</script>


</body>
</html>
